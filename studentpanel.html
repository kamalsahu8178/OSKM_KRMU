<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Canteen Panel</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f4f4f4;
      }

      .box {
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        width: 80%;
        max-width: 800px;
        margin: 30px auto;
      }

      h1,
      h2 {
        text-align: center;
      }

      .item {
        display: flex;
        justify-content: space-between;
        margin: 10px 0;
      }

      button {
        padding: 6px 12px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      button:hover {
        background: #45a049;
      }

      .cart-items,
      .order-history {
        margin-top: 10px;
      }

      .order {
        border-bottom: 1px solid #ddd;
        padding: 5px 0;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        z-index: 10;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
      }

      .modal-content {
        background: white;
        margin: 10% auto;
        padding: 20px;
        border-radius: 10px;
        width: 300px;
        text-align: center;
      }

      .logout-btn {
        background: #e74c3c;
        margin-top: 20px;
      }

      .logo {
        display: flex;
        justify-content: center;
        margin-bottom: 20px;
      }

      .logo img {
        height: 100px;
      }
      .icon1 {
        display: flex;
        justify-content: left;
        align-items: last baseline;
      }
    </style>
  </head>
  <body>
    <div class="box" id="user-panel">
      <div class="logo">
        <img src="./OSCM KRMU LOGO.png" alt=" KRMU Logo" />
      </div>
      <h1>&#128221;Canteen Menu</h1>
      <hr />
      <h2 class="icon1">ðŸ“‹Menu</h2>
      <div id="menu-list"></div>

      <h2 class="icon1">ðŸ›’Cart</h2>
      <div class="cart-items" id="cart-items">No items yet.</div>
      <p><b>Total:</b> â‚¹<span id="total">0</span></p>
      <button onclick="startPayment()">Place Order</button>

      <h2 class="icon1">ðŸ“¦My Orders</h2>
      <div id="order-history">No orders yet.</div>

      <a href="index.html"
        ><button class="logout-btn" onclick="logout()">Logout</button></a
      >
    </div>

    <!--PAYMENT MODAL -->

    <div id="paymentModal" class="modal">
      <div class="modal-content">
        <h3>ðŸ’³ Pay via UPI</h3>
        <p>Scan & Pay (Mock)</p>
        <div class="qr">
          <img
            src="./qr.jpg"
            alt="QR Code"
            style="width: 100%; max-height: 300px"
          />
        </div>
        <button onclick="confirmPayment()">Mark as Paid</button>
        <button class="logout-btn" onclick="closePayment()">Cancel</button>
      </div>
    </div>

    <script>
      let menu = JSON.parse(localStorage.getItem("menu")) || [
        { id: 1, name: "Samosa", price: 15, stock: 10 },
        { id: 2, name: "Tea", price: 10, stock: 20 },
        { id: 3, name: "Sandwich", price: 40, stock: 8 },
        { id: 4, name: "Chowmein", price: 50, stock: 5 },
      ];

      let cart = [];
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let pendingOrder = null;
      let currentUser = null;

      const userName = "Student"; // Static user (optional: fetch from login/session)

      function loadMenu() {
        const menuList = document.getElementById("menu-list");
        menuList.innerHTML = "";
        menu.forEach((item) => {
          menuList.innerHTML += `
            <div class="item">
              <span>${item.name} - â‚¹${item.price} (Stock: ${item.stock})</span>
              <button onclick="addToCart(${item.id})">Add</button>
            </div>`;
        });
        localStorage.setItem("menu", JSON.stringify(menu));
      }

      function addToCart(id) {
        const item = menu.find((i) => i.id === id);
        if (!item || item.stock <= 0) {
          alert("Out of Stock!");
          return;
        }

        const cartItem = cart.find((c) => c.id === id);
        if (cartItem) {
          cartItem.quantity = (cartItem.quantity || 1) + 1;
        } else {
          cart.push({ ...item, quantity: 1 });
        }

        item.stock--;
        loadMenu();
        displayCart();
      }

      function displayCart() {
        const cartDiv = document.getElementById("cart-items");
        if (cart.length === 0) {
          cartDiv.innerHTML = "No items yet.";
          document.getElementById("total").innerText = 0;
          return;
        }

        cartDiv.innerHTML = cart
          .map(
            (i) =>
              `<div>${i.name} x${i.quantity} - â‚¹${i.price * i.quantity}</div>`
          )
          .join("");
        document.getElementById("total").innerText = cart.reduce(
          (t, i) => t + i.price * i.quantity,
          0
        );
      }

      function startPayment() {
        if (cart.length === 0) {
          alert("Cart is empty!");
          return;
        }

        const orderId = "ORD" + Math.floor(Math.random() * 10000);
        const total = cart.reduce((t, i) => t + i.price * i.quantity, 0);
        pendingOrder = {
          id: orderId,
          items: [...cart],
          total: total,
          status: "Pending ðŸ’¸",
          user: userName,
        };

        document.getElementById("paymentModal").style.display = "block";
      }

      function confirmPayment() {
        pendingOrder.status = "Paid âœ…";
        orders.push(pendingOrder);
        localStorage.setItem("orders", JSON.stringify(orders));
        cart = [];
        displayCart();
        loadOrders();
        alert(`Order Placed! Order ID: ${pendingOrder.id}`);
        pendingOrder = null;
        closePayment();
      }

      function closePayment() {
        document.getElementById("paymentModal").style.display = "none";
        pendingOrder = null;
      }

      function loadOrders() {
        const orderDiv = document.getElementById("order-history");
        const myOrders = orders.filter((o) => o.user === userName);
        if (myOrders.length === 0) {
          orderDiv.innerHTML = "No orders yet.";
          return;
        }
        orderDiv.innerHTML = myOrders
          .map(
            (o) =>
              `<div class="order"><b>${o.id}</b> - â‚¹${o.total} - ${o.status}</div>`
          )
          .join("");
      }

      function logout() {
        if (confirm("Are you sure you want to logout?")) {
          window.location.reload();
        }
      }

      window.onload = () => {
        loadMenu();
        displayCart();
        loadOrders();
      };
    </script>
  </body>
</html>